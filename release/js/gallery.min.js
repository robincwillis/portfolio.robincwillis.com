portfolio.Models.ProjectLink=Backbone.Model.extend({}),portfolio.Models.Media=Backbone.Model.extend({}),portfolio.Models.Project=Backbone.Model.extend({defaults:{state:""},parse:function(t){var e=$.isArray(t.web.tags.tag)?t.web.tags.tag:[t.web.tags.tag];return this.tags=new portfolio.Models.Tag({tags:e}),this.media=new portfolio.Collections.Media(t.web.media.gal),void 0!==t.web.links&&(this.links=new portfolio.Collections.Links(t.web.links.link)),t},select:function(t){this.set({state:t?"selected":""})}}),portfolio.Models.Tag=Backbone.Model.extend({}),portfolio.Collections.Links=Backbone.Collection.extend({model:portfolio.Models.ProjectLink}),portfolio.Collections.Media=Backbone.Collection.extend({model:portfolio.Models.Media}),portfolio.Collections.Projects=Backbone.Collection.extend({model:portfolio.Models.Project,url:portfolio.xml_url,initialize:function(t){this.original=t},parse:function(t){var e=[],n=$.xml2json(t);return _.each(n.project,function(t){"on"==t.display&&e.push(t)}),e},fetch:function(t){return t=t||{},t.dataType="xml",Backbone.Collection.prototype.fetch.call(this,t)},select:function(t){this.selectedProject()&&this.selectedProject().select(!1),this.selected=t,this.selected.select(!0),this.trigger("projects:selected")},selectedProject:function(){return this.selected},filterCollection:function(t){if(""===t)this.trigger("filter:thumbnails",this.models);else{console.log("need to redo this logic for tags");var e=_.filter(this.models,function(e){return _.contains(e.tags.get("tags"),t)});console.log(e),this.trigger("filter:thumbnails",e)}}}),portfolio.Collections.Tags=Backbone.Collection.extend({model:portfolio.Models.Tag}),portfolio.Views.Footer=Backbone.View.extend({el:$("footer"),template:portfolio.Templates.footer,initialize:function(){},render:function(){return this.$el.html(this.template()),this}}),portfolio.Views.Header=Backbone.View.extend({el:$("header"),template:portfolio.Templates.header,initialize:function(){},render:function(){return this.$el.html(this.template()),this}}),portfolio.Views.PreloaderView=Backbone.View.extend({el:"div.preloader-container",template:portfolio.Templates.preloader,initialize:function(){this.render()},render:function(){return this.$el.append(this.template()),$(".preloader-container").toggleClass("load-in"),this},handleProgress:function(t){var e=0;t.lengthComputable&&(e=t.loaded/t.total),$(".progress-bar").width(100*e)},finishProgress:function(){$(".preloader-container").toggleClass("load-out");var t=this;setTimeout(function(){t.remove()},400)}}),portfolio.Views.ProjectView=Backbone.View.extend({el:$("#project"),events:{"click .close":"loadGallery","click .prev":"prevSlide","click .next":"nextSlide","click .dot":"goToSlide"},template:portfolio.Templates.project,initialize:function(){this.model.bind("projects:selected",this.render,this),console.log("finished init")},render:function(){var t=this,e=this.template(this.model.selectedProject().toJSON());return _.delay(function(){t.$el.html(e).hide().fadeIn(500),t.loadSlideShow()},700),this},loadGallery:function(){this.model.selectedProject().select(!1),this.removeSlideShow(),this.trigger("show:listview")},loadSlideShow:function(){var t=[];_(this.model.selectedProject().media.models).each(function(e){t.push({img:e.get("text"),width:e.get("width"),height:e.get("height")})},this);var e=new SwipeView("#wrapper",{numberOfPages:t.length});this.slideshow=e,console.log(e),console.log("PageWidth"+e.pageWidth);var n='<li class="prev"><div class="arrow-left"></div></li>';for(n+="",i=0;this.model.selectedProject().media.models.length>i;i++)n+=0===i?'<li class="dot selected" id="'+i+'"></li>':'<li class="dot" id="'+i+'"></li>';n+='<li class="next"><div class="arrow-right"></div></li>',$("#nav").html(n);var s=document.querySelectorAll("#nav li");for(i=0;3>i;i++)page=0===i?t.length-1:i-1,el=document.createElement("img"),el.src="https://s3.amazonaws.com/robincwillis-portfolio/"+t[page].img,el.width=t[page].width,el.height=t[page].height,e.masterPages[i].appendChild(el);console.log(e.masterPages),e.onFlip(function(){console.log("onFlip "+e);var n,i,r;for(r=0;3>r;r++)i=e.masterPages[r].dataset.upcomingPageIndex,i!=e.masterPages[r].dataset.pageIndex&&(n=e.masterPages[r].querySelector("img"),n.src="https://s3.amazonaws.com/robincwillis-portfolio/"+t[i].img,n.width=t[i].width,n.height=t[i].height);document.querySelector("#nav .selected").className="",s[e.pageIndex+1].className="selected"}),e.onMoveOut(function(){e.masterPages[e.currentMasterPage].className=e.masterPages[e.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,"")}),e.onMoveIn(function(){var t=e.masterPages[e.currentMasterPage].className;/(^|\s)swipeview-active(\s|$)/.test(t)||(e.masterPages[e.currentMasterPage].className=t?t+" swipeview-active":"swipeview-active")})},nextSlide:function(){this.slideshow.next()},prevSlide:function(){this.slideshow.prev()},goToSlide:function(t){this.slideshow.goToPage(parseInt(t.currentTarget.id))},removeSlideShow:function(){this.slideshow.destroy()}}),portfolio.Views.ProjectListView=Backbone.View.extend({el:$("#thumbs"),_views:{},initialize:function(){this.$el.isotope({animationEngine:"best-available",itemSelector:".thumbnail-item",layoutMode:"fitRows"}),this.listenTo(this.collection,"reset sync",this.render),this.collection.on("filter:thumbnails",this.filterThumbnails,this)},render:function(){console.log("project list render called "+this.collection.models.length),_(this.collection.models).each(function(t){this.renderThumbnail(t)},this)},renderThumbnail:function(t){var e=new portfolio.Views.ThumbView({model:t});this._views[e.model.cid]=e,this.$el.append(e.render().el),this.listenTo(e,"select:project",this.selectProject),this.$el.isotope("insert",$(e.render().el))},filterThumbnails:function(t){_.each(t,function(t){this._views[t.cid].$el.addClass("filter")},this),this.$el.isotope({filter:".filter"}),_.each(t,function(t){this._views[t.cid].$el.removeClass("filter")},this)},selectProject:function(t){this.collection.select(t),this.trigger("hide:listview"),this.trigger("show:detailview")}}),portfolio.Views.StaticView=Backbone.View.extend({initialize:function(){},render:function(){return this.$el.html(this.template()),this}}),portfolio.Views.TagListView=Backbone.View.extend({el:$("#tag-list"),events:{"click .tag":"selectFilter"},template:portfolio.Templates.taglist,initialize:function(){},render:function(){return this.$el.html(this.template()),this},selectFilter:function(t){var e="";$(t.target).hasClass("selected")?$(t.target).removeClass("selected"):(e=t.target.text,this.$(".tag").removeClass("selected"),$(t.target).addClass("selected")),this.trigger("filter:listview",e)}}),portfolio.Views.ThumbView=Backbone.View.extend({tagName:"li",attributes:function(){return{"data-filter":this.model.cid}},className:"span6 thumbnail-item",template:portfolio.Templates.thumbnail,events:{click:"selectProject"},initialize:function(){_.bindAll(this,"render","selectProject")},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},selectProject:function(){this.trigger("select:project",this.model)}}),function(t){portfolio.Views.AppView=Backbone.View.extend({initialize:function(){this.projects=new portfolio.Collections.Projects,this.preloaderView=new portfolio.Views.PreloaderView,this.projectListView=new portfolio.Views.ProjectListView({collection:this.projects}),this.projectView=new portfolio.Views.ProjectView({model:this.projects}),this.tagListView=new portfolio.Views.TagListView,this.header=new portfolio.Views.Header,this.footer=new portfolio.Views.Footer,this.listenTo(this.projectView,"show:listview",this.showProjectListView),this.listenTo(this.projectListView,"hide:listview",this.hideProjectListView),this.listenTo(this.tagListView,"filter:listview",this.filterProjectList);var t=this;setTimeout(function(){t.fetchProjects()},300)},fetchProjects:function(){var e=this;this.projects.fetch({xhr:function(){var n=t.ajaxSettings.xhr();return n.onprogress=e.preloaderView.handleProgress,n},success:function(){e.preloaderView.finishProgress(),e.header.render(),e.tagListView.render(),_.delay(function(){e.footer.render()},500)}})},hideProjectListView:function(){this.projectListView.$el.fadeOut(500),this.tagListView.$el.fadeOut(500),this.footer.$el.fadeOut(500,function(){t(this).delay(800).fadeIn(500)})},showProjectListView:function(){var e=this;this.footer.$el.fadeOut(500),this.projectView.$el.fadeOut(500,function(){t(this).empty()}),_.delay(function(){e.projectListView.$el.fadeIn(500),e.tagListView.$el.fadeIn(500),e.footer.$el.fadeIn(500)},700)},filterProjectList:function(t){this.projects.filterCollection(t)}}),new portfolio.Views.AppView}(jQuery);
//@ sourceMappingURL=site/gallery.min.js.map